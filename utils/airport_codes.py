
airport_names = {
    "SVO": "Москва (Шереметьево)",
    "DME": "Москва (Домодедово)",
    "VKO": "Москва (Внуково)",
    "ZIA": "Москва (Жуковский)",  # международный
    "LED": "Санкт‑Петербург (Пулково)",
    "OVB": "Новосибирск (Толмачёво)",
    "AER": "Сочи (Адлер‑Сочи)",
    "SVX": "Екатеринбург (Кольцово)",
    "KJA": "Красноярск (Емельяново)",
    "IKT": "Иркутск (Иркутск)",
    "KZN": "Казань (Казань Международный)",
    "UFA": "Уфа (Уфа Международный)",
    "MRV": "Минеральные Воды (Минеральные Воды)",
    "TJM": "Тюмень (Рощино)",
    "VVO": "Владивосток (Владивосток Международный)",
    "KGD": "Калининград (Храброво)",
    "KUF": "Самара (Курумоч)",
    "KHV": "Хабаровск (Хабаровск‑Новый)",
    "SGC": "Сургут (Сургут Международный)",
    "YKS": "Якутск (Якутск)",
    "MCX": "Махачкала (Уйташ)",
    "KRR": "Краснодар (Пашковский)",
    "GOJ": "Нижний Новгород (Стригино)",
    "PEE": "Пермь (Большое Савино)",
    "CEK": "Челябинск (Челябинск)",
    "PES": "Петрозаводск (Петрозаводск)",
    "HTA": "Чита (Кадала)",
    "ASF": "Астрахань (Нариманово)",
    "EGO": "Белгород (Белгород Международный)",
    "SCW": "Сыктывкар (Сыктывкар)",
    "VOZ": "Воронеж (Воронеж Международный)",
    "RTW": "Саратов (Гагарин)",
    "STW": "Ставрополь (Шпаковское)",
    "OGZ": "Владикавказ (Беслан)",
    "UUD": "Улан‑Удэ (Байкал)",
    "ULV": "Ульяновск (Баратаевка)",
    "UUS": "Южно‑Сахалинск (Южно‑Сахалинск)",  # UUS в списке международных :contentReference[oaicite:2]{index=2}
    "ABA": "Абакан (Абакан Международный)",
    "DYR": "Анадырь (Угольный)",
    "AAQ": "Анапа (Анапа)",
    "ARH": "Архангельск (Талаги)",
    "BAX": "Барнаул (Барнаул)",
    "BQS": "Благовещенск (Игнатьево)",
    "BTK": "Братск (Братск)",
    "BZK": "Брянск (Брянск)",
    "CEE": "Череповец (Череповец)",
    "ESL": "Элиста (Элиста)",
    "GRV": "Грозный (Грозный)",
    "BQS": "Благовещенск (Игнатьево)",
    "BAX": "Барнаул (Барнаул)",
    "PVS": "Провидения (Provideniya Bay)",
    "NBC": "Набережные Челны (Нижнекамск, Begishevo)",  # NBC код Begishevo International
    "OMS": "Омск (Омск Центральный)",
    "VOG": "Волгоград (Гумрак, Волгоград Международный)",
    "NAL": "Нальчик (Нальчик)",
    "NJC": "Нижневартовск (Нижневартовск)",
    "NOZ": "Новокузнецк (Спиченково)",
    "PKC": "Петропавловск‑Камчатский (Елизово)",
    "PKV": "Псков (Псков)",

    # Ближний Восток и Персидский залив
    "DXB": "Дубай (Dubai International — Объединённые Арабские Эмираты)",
    "DOH": "Доха (Hamad International — Катар)",

    # Европа
    "LHR": "Лондон (Heathrow — Великобритания)",
    "CDG": "Париж (Charles de Gaulle — Франция)",
    "FRA": "Франкфурт (Frankfurt Airport — Германия)",
    "AMS": "Амстердам (Schiphol — Нидерланды)",

    # Азия
    "ICN": "Сеул (Incheon International — Южная Корея)",
    "SIN": "Сингапур (Changi — Сингапур)",
    "PEK": "Пекин (Capital International — Китай)",
    "PVG": "Шанхай (Pudong International — Китай)",
    "HKG": "Гонконг (Hong Kong International — Китай)",
    "HND": "Токио (Haneda — Япония)",
    "NRT": "Токио (Narita — Япония)",
    "BKK": "Бангкок (Suvarnabhumi — Таиланд)",
    "DEL": "Дели (Indira Gandhi International — Индия)",

    # Северная Америка
    "ATL": "Атланта (Hartsfield‑Jackson — США)",
    "LAX": "Лос‑Анджелес (Los Angeles International — США)",
    "JFK": "Нью‑Йорк (John F. Kennedy International — США)",
    "ORD": "Чикаго (O'Hare International — США)",

    # Австралия и Океания
    "SYD": "Сидней (Kingsford Smith — Австралия)",
    "MEL": "Мельбурн (Tullamarine — Австралия)",

    # Южная Америка
    "GRU": "Сан‑Паулу (Guarulhos International — Бразилия)",
    "BOG": "Богота (El Dorado International — Колумбия)",
    "EZE": "Буэнос‑Айрес (Ezeiza Ministro Pistarini — Аргентина)",
    "SCL": "Сантьяго (Comodoro Arturo Merino Benítez — Чили)",

    # Африка
    "JNB": "Йоханнесбург (O. R. Tambo International — ЮАР)",
    "CAI": "Каир (Cairo International — Египет)",
    "CPT": "Кейп‑таун (Cape Town International — ЮАР)",
    "ADD": "Аддис‑Абеба (Bole International — Эфиопия)",
    "NBO": "Найроби (Jomo Kenyatta International — Кения)",
}


def get_airport_name(code: str) -> str:
    return airport_names.get(code.upper(), code.upper())


def _normalize_text(value: str) -> str:
    s = (value or "").strip().lower()
    # Приводим разные дефисы/тире к пробелам и убираем редкие символы
    for ch in ["\u2011", "\u2013", "\u2014", "\u2212", "-", "\u00a0"]:
        s = s.replace(ch, " ")
    s = s.replace("ё", "е")
    while "  " in s:
        s = s.replace("  ", " ")
    return s


def find_airports_by_city(city_query: str):
    """Возвращает список вариантов [(IATA, label)] по названию города.

    Сопоставляет по началу строки до скобок: например,
    "Москва (Домодедово)" → городовая часть "Москва".
    Ищет варианты, у которых городовая часть начинается с переданным запросом.
    """
    query = _normalize_text(city_query)
    if not query:
        return []

    results = []
    for code, label in airport_names.items():
        # Берём часть до первой скобки как город
        city_part = label.split(" (")[0]
        city_norm = _normalize_text(city_part)
        if city_norm.startswith(query) or query.startswith(city_norm):
            results.append((code, label))

    # Упорядочим стабильно по названию (для красивого вывода)
    results.sort(key=lambda x: _normalize_text(x[1]))
    return results


def format_airport_option(iata: str, label: str) -> str:
    """Форматирует строку для выбора аэропорта пользователем."""
    return f"{label} — {iata}"
